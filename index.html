<!DOCTYPE html>
<html lang=fr>
  <meta charset=UTF-8>
  <meta name=viewport content="width=device-width", initial-scale=1.0>
  <meta http-equiv=X-UA-Compatible content="ie=edge">
  <title>Daktary : Lecteur de ressources Github</title>
  <link rel=stylesheet href=./css/reset.css>
  <link rel=stylesheet href=./css/daktary.css>
  <link rel=stylesheet href=./css/blob.css>

  <script type=text/javascript src=index.js></script>

  <a name=top></a>
  <main class=container id=ghBlob>
    <aside class=ghBlobTools>
      <a href="" title="Voir sur Github" class="ghBlobLink tooltip" id=ghBlobUrl></a>
      <a href="#top" class="page-top">Haut de page</a>
    </aside>
    <article id=ghBlobContent></article>
  </main>
  <script>
    const getHtmlBlobContent = () => document.querySelector('#ghBlob').querySelector('#ghBlobContent')
    const getHtmlBlobGhLink = () => document.querySelector('#ghBlob').querySelector('a#ghBlobUrl')
    const getHash = () => document.location.hash.match(/#(.*)/)[1]
    const getAnchor = hash => document.querySelector(`a[name="${hash}"]`)

    window.addEventListener('DOMContentLoaded', () => {
      getHtmlBlobGhLink().setAttribute('href', `https://github.com/${getHash()}`)
      injectBlobInHtml(getHash(), getHtmlBlobContent())
    })
    window.addEventListener('hashchange', evt => {
      const anchor = getAnchor(getHash()) 
      if (!! anchor) {
        anchor.scrollIntoView()
        window.location = evt.oldURL
      } else {
        getHtmlBlobGhLink().setAttribute('href', `https://github.com/${getHash()}`)
        injectBlobInHtml(getHash(), getHtmlBlobContent())
      }
    })
  </script>
</html>
